# PianoNet
## About
PianoNet is a deep neural network for generating piano compositions. The model architectures are similar to the dilated convolutional networks described in [WaveNet](https://arxiv.org/abs/1609.03499), with modifications for being able to handle piano midi data. These modifications are necessary, as piano notes are a time series of key states (2-dimensional), rather than 1-dimensional samples like the audio used to train WaveNet.

For an example performance generated by a medium-sized model, visit PianoNet's [SoundCloud page](https://soundcloud.com/tom-angsten)

## Features
* Build a generative piano model in minutes, train in a few days on a modern laptop
* Queue-based generation algorithm removing redundant convolution operations for lightning-fast piano performances
* Framework for easy experimentation using file-based interface for finding the optimal model architecture
* Clear logging of training results for tracking of training history
* Object-oriented abstraction of data components for painless dataset creation from raw midi files

## Installation

1. Clone this repository to a local directory in which your python projects are normally located (`git clone https://github.com/angsten/pianonet.git`)
2. Navigate into the cloned directory using `cd pianonet`
3. Create a [python virtualenv](https://docs.python.org/3/library/venv.html) in this directory by running `mkdir ./venv` and then `python3 -m venv ./venv`
4. Activate the virtualenv using `source ./venv/bin/activate`
5. Add the pianonet module to your `PYTHONPATH` environment variable by running `export PYTHONPATH="${PYTHONPATH}:${PWD}"`
6. Run `pip install -r requirements.txt` (this will take anywhere from 2 to 15 minutes depending on internet and computer speeds)

## Example Usage

An end-to-end example, from dataset creation to performance generation, can be found in the examples/pianonet_mini directory. Here are the steps to run this example:

### Training the Model

Note: This will take approximately 5 minutes of active time and 25 minutes of training time to complete. You can stop training after five minutes and the rest of the tutorial will still work.

1. Navigate to the example directory with `cd examples/pianonet_mini`
2. To create the training and validation datasets, run `python ../../pianonet/scripts/master_note_array_creation.py ./dataset_creation_description.json ./`
3. To initiate training, run `python ../../pianonet/scripts/runner.py ./` In a separate terminal in the same directory, you can run `tail -n 10000 -f output_train.log` to monitor the training loss in real time. The trained model will be checkpointed at `./models/0_trained` This entire process should take about 20 minutes on a fast computer
4. If you wish to further train the model, re-run the command in the above step. This will concatenate output to output_train.log as before, and the new model will be checkpointed at `./models/1_trained`

### Generating Performances

1. Within the `examples/pianonet_mini` directory, run the command `../../venv/bin/jupyter notebook` (if this doesn't work, make sure your venv is activated and your `PYTHONPATH` environment variable is pointing to the pianonet project directory as noted above). This should start a notebook server and open a local file tree within your directory. Click on the notebook file named `get_performances.ipynb`
2. Once you've opened the notebook, run the cells in order and read the provided notes. You will be able to listen to your models performances and save any of these as midi files.

### How Can I Improve my Model's Performances?

If things don't sound like you had hoped, you can train longer, make the model bigger, or add more data by scraping piano midi files from the internet. Any midi files you want to add to the training set can be added to the `examples/pianonet_mini/midi/` directory, but you must then rerun all of the steps in the training portion of the tutorial. To make the model wider, open the `examples/pianonet_mini/run_description.json` file and increase the values of the `filter_increments` array by around two and restart training. Alternatively, add more values to the `filter_increments` lists to make the model deeper.

Enjoy, and please report any issues you run into!
